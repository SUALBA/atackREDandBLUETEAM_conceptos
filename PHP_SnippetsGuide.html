<!DOCTYPE html>
<html lang="es">
</head>
<body class="bg-light text-dark">
  <main class="container py-5">
    <h1 class="mb-4">Guía Completa de 50 Snippets PHP</h1>
    <p class="lead">Cada snippet incluye descripción y código listo para copiar. Usa los botones para copiar al portapapeles.</p>
    <div class="accordion" id="snippetsAccordion">
      <!-- 1-10 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading1">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
            1. <code>sanitize_input()</code> — trim + htmlspecialchars
          </button>
        </h2>
        <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Limpia una cadena: recorta espacios y escapa caracteres HTML.</p>
            <pre><code class="language-php"><?php
function sanitize_input(string $data): string {
    return htmlspecialchars(trim($data), ENT_QUOTES, 'UTF-8');
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- snippets 2-10 similar structure, collapse closed -->
      <!-- For brevity, include them collapsed -->
      <!-- 2 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading2">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
            2. validate_email() — filter_var + FILTER_VALIDATE_EMAIL
          </button>
        </h2>
        <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Valida una dirección de correo electrónico.</p>
            <pre><code class="language-php"><?php
function validate_email(string $email) {
    return filter_var($email, FILTER_VALIDATE_EMAIL);
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 3 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading3">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
            3. sanitize_int() — FILTER_SANITIZE_NUMBER_INT
          </button>
        </h2>
        <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Extrae solo dígitos y signos de una cadena.</p>
            <pre><code class="language-php"><?php
function sanitize_int($input): int {
    return (int) filter_var($input, FILTER_SANITIZE_NUMBER_INT);
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 4 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading4">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4">
            4. sanitize_url() — FILTER_SANITIZE_URL
          </button>
        </h2>
        <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Elimina caracteres no válidos de una URL.</p>
            <pre><code class="language-php"><?php
function sanitize_url(string $url): string {
    return filter_var($url, FILTER_SANITIZE_URL);
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 5 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading5">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5">
            5. sanitize_string() — FILTER_SANITIZE_STRING
          </button>
        </h2>
        <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Retira etiquetas HTML y caracteres especiales.</p>
            <pre><code class="language-php"><?php
function sanitize_string(string $str): string {
    return filter_var($str, FILTER_SANITIZE_STRING);
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 6 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading6">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse6">
            6. Uso de PDO con Prepared Statements
          </button>
        </h2>
        <div id="collapse6" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Evita inyecciones SQL usando consultas preparadas.</p>
            <pre><code class="language-php"><?php
$pdo = new PDO('mysql:host=localhost;dbname=mi_bd;charset=utf8mb4', 'usuario', 'pass', [
    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
]);
$stmt = $pdo->prepare('SELECT * FROM users WHERE id = :id');
$stmt->execute(['id' => $userId]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 7 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading7">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse7">
            7. validate_ip() — FILTER_VALIDATE_IP
          </button>
        </h2>
        <div id="collapse7" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Comprueba que una cadena es una IP válida.</p>
            <pre><code class="language-php"><?php
function validate_ip(string $ip): bool {
    return filter_var($ip, FILTER_VALIDATE_IP) !== false;
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 8 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading8">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse8">
            8. Limpieza de HTML con HTMLPurifier
          </button>
        </h2>
        <div id="collapse8" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Limpia HTML malicioso usando HTMLPurifier.</p>
            <pre><code class="language-php"><?php
require_once 'vendor/autoload.php';
$config = HTMLPurifier_Config::createDefault();
$purifier = new HTMLPurifier($config);
function clean_html(string $dirty_html): string {
    global $purifier;
    return $purifier->purify($dirty_html);
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 9 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading9">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse9">
            9. validate_date() — DateTime::createFromFormat
          </button>
        </h2>
        <div id="collapse9" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Valida que la fecha siga el formato YYYY-MM-DD.</p>
            <pre><code class="language-php"><?php
function validate_date(string $date): bool {
    $d = DateTime::createFromFormat('Y-m-d', $date);
    return $d && $d->format('Y-m-d') === $date;
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 10 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading10">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse10">
            10. limit_length() — mb_substr
          </button>
        </h2>
        <div id="collapse10" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Trunca una cadena a un máximo de caracteres respetando UTF-8.</p>
            <pre><code class="language-php"><?php
function limit_length(string $str, int $max = 255): string {
    return mb_substr($str, 0, $max, 'UTF-8');
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 11 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading11">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse11">
            11. Content-Security-Policy básica
          </button>
        </h2>
        <div id="collapse11" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Restringe recursos solo al propio origen.</p>
            <pre><code class="language-php"><?php
header("Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self';");
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 12 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading12">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse12">
            12. HSTS (Strict-Transport-Security)
          </button>
        </h2>
        <div id="collapse12" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Fuerza HTTPS durante 1 año (+ subdominios).</p>
            <pre><code class="language-php"><?php
header('Strict-Transport-Security: max-age=31536000; includeSubDomains; preload');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 13 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading13">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse13">
            13. X-Frame-Options: SAMEORIGIN
          </button>
        </h2>
        <div id="collapse13" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Evita clickjacking restringiendo iframes al mismo origen.</p>
            <pre><code class="language-php"><?php
header('X-Frame-Options: SAMEORIGIN');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 14 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading14">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse14">
            14. X-Content-Type-Options: nosniff
          </button>
        </h2>
        <div id="collapse14" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Bloquea que el navegador infiera tipo MIME incorrecto.</p>
            <pre><code class="language-php"><?php
header('X-Content-Type-Options: nosniff');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 15 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading15">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse15">
            15. Referrer-Policy: no-referrer
          </button>
        </h2>
        <div id="collapse15" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>No envía información del Referer.</p>
            <pre><code class="language-php"><?php
header('Referrer-Policy: no-referrer');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 16 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading16">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse16">
            16. Permissions-Policy (Feature-Policy)
          </button>
        </h2>
        <div id="collapse16" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Limita uso de APIs (geolocation, microphone).</p>
            <pre><code class="language-php"><?php
header("Permissions-Policy: geolocation=(), microphone=()");
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 17 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading17">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse17">
            17. X-XSS-Protection: mode=block
          </button>
        </h2>
        <div id="collapse17" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Activa filtro XSS en navegadores antiguos.</p>
            <pre><code class="language-php"><?php
header('X-XSS-Protection: 1; mode=block');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 18 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading18">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse18">
            18. Cache-Control: no-store, no-cache
          </button>
        </h2>
        <div id="collapse18" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Impide almacenamiento en caché de contenido sensible.</p>
            <pre><code class="language-php"><?php
header('Cache-Control: no-store, no-cache, must-revalidate');
header('Pragma: no-cache');
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading19">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse19">
            19. Forzar HTTPS en PHP antes de servir contenido
          </button>
        </h2>
        <div id="collapse19" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Redirige a HTTPS si no está en conexión segura.</p>
            <pre><code class="language-php"><?php
if (empty($_SERVER['HTTPS']) || $_SERVER['HTTPS'] === 'off') {
    header('Location: https://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']);
    exit;
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 20 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading20">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse20">
            20. session_start() con parámetros seguros
          </button>
        </h2>
        <div id="collapse20" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Inicia sesión con cookies seguras HttpOnly y Secure.</p>
            <pre><code class="language-php"><?php
session_set_cookie_params([
    'lifetime' => 0,
    'path'     => '/',
    'domain'   => $_SERVER['HTTP_HOST'],
    'secure'   => true,
    'httponly' => true,
    'samesite' => 'Strict'
]);
session_start();
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 21 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading21">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse21">
            21. session_regenerate_id(true)
          </button>
        </h2>
        <div id="collapse21" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Regenera el ID de sesión para prevenir fijación.</p>
            <pre><code class="language-php"><?php
session_start();
session_regenerate_id(true);
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 22 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading22">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse22">
            22. Generar token CSRF
          </button>
        </h2>
        <div id="collapse22" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Crea y almacena token CSRF en sesión.</p>
            <pre><code class="language-php"><?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}
?><!-- En el formulario -->
<input type="hidden" name="csrf_token" value="<?= $_SESSION['csrf_token'] ?>">
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 23 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading23">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse23">
            23. Validar token CSRF con hash_equals()
          </button>
        </h2>
        <div id="collapse23" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Comprueba coincidencia de token en petición.</p>
            <pre><code class="language-php"><?php
session_start();
if (empty($_POST['csrf_token']) || !hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {
    die('CSRF inválido');
}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 24 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading24">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse24">
            24. Timeout de sesión por inactividad
          </button>
        </h2>
        <div id="collapse24" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Cierra sesión tras tiempo de inactividad.</p>
            <pre><code class="language-php"><?php
session_start();
$timeout = 1800;
if (isset($_SESSION['last_activity']) && time() - $_SESSION['last_activity'] > $timeout) {
    session_unset();
    session_destroy();
    header('Location: login.php');
    exit;
}
$_SESSION['last_activity'] = time();
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- 25 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading25">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse25">
            25. Logout seguro
          </button>
        </h2>
        <div id="collapse25" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Destruye sesión y expira cookies.</p>
            <pre><codeclass="language-php"><?php
session_start();
session_unset();
session_destroy();
setcookie(session_name(), '', time() - 3600, '/');
header('Location: index.php');
exit;
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>

      <!-- Ítem 26 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading26">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse26">26. Revisar IP y User-Agent</button>
        </h2>
        <div id="collapse26" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <p>Verifica consistencia de IP y UA.</p>
            <pre><code class="language-php"><?php
session_start();
if(isset($_SESSION['ip'],$_SESSION['ua'])){
  if($_SESSION['ip']!=$_SERVER['REMOTE_ADDR']||$_SESSION['ua']!=$_SERVER['HTTP_USER_AGENT'])session_destroy();
}else{$_SESSION['ip']=$_SERVER['REMOTE_ADDR'];$_SESSION['ua']=$_SERVER['HTTP_USER_AGENT'];}
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 27 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading27">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse27">27. Cifrar con Defuse</button>
        </h2>
        <div id="collapse27" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
use Defuse\Crypto\Crypto;use Defuse\Crypto\Key;
$key=Key::loadFromAsciiSafeString(file_get_contents('secret.key'));
$ct=Crypto::encrypt('texto',$key);
$pt=Crypto::decrypt($ct,$key);
?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 28 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading28">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse28">28. Logging personalizado</button>
        </h2>
        <div id="collapse28" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
function log_event($m){file_put_contents('app.log',date('c')." $m\n",FILE_APPEND);}?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 29 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading29">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse29">29. Monitoreo de XSS</button>
        </h2>
        <div id="collapse29" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
if(stripos($_SERVER['REQUEST_URI'],'<script')!==false){log_event('XSS '.$_SERVER['REQUEST_URI']);http_response_code(400);exit;}?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 30 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading30">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse30">30. Rate limiting sesión</button>
        </h2>
        <div id="collapse30" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
session_start();$ip=$_SERVER['REMOTE_ADDR'];if(!isset($_SESSION['r'][$ip])){$_SESSION['r'][$ip]=['c'=>1,'t'=>time()];}else{$_SESSION['r'][$ip]['c']++;if(time()-$_SESSION['r'][$ip]['t']>3600)$_SESSION['r'][$ip]=['c'=>1,'t'=>time()];}if($_SESSION['r'][$ip]['c']>100)exit;?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 31 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading31">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse31">31. Notificación por email</button>
        </h2>
        <div id="collapse31" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
if(stripos($_SERVER['REQUEST_URI'],'<script')!==false)mail('admin@dominio.com','XSS','URI '.$_SERVER['REQUEST_URI']);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 32 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading32">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse32">32. Blacklist IP</button>
        </h2>
        <div id="collapse32" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$bl=file('bl.txt',FILE_IGNORE_NEW_LINES);if(in_array($_SERVER['REMOTE_ADDR'],$bl))http_response_code(403);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 33 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading33">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse33">33. syslog()</button>
        </h2>
        <div id="collapse33" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
openlog('app',LOG_PID,LOG_USER);syslog(LOG_ALERT,'XSS');closelog();?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 34 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading34">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse34">34. Logs en BD</button>
        </h2>
        <div id="collapse34" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$pdo->prepare('INSERT INTO logs(ip,uri) VALUES(?,?)')->execute([$_SERVER['REMOTE_ADDR'],$_SERVER['REQUEST_URI']]);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 35 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading35">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse35">35. Validar Referer</button>
        </h2>
        <div id="collapse35" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
if(parse_url($_SERVER['HTTP_REFERER'],PHP_URL_HOST)!=$_SERVER['HTTP_HOST'])http_response_code(403);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 36 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading36">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse36">36. Logs JSON para ELK</button>
        </h2>
        <div id="collapse36" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
file_put_contents('elk.log',json_encode(['time'=>date('c'),'ip'=>$_SERVER['REMOTE_ADDR'],'uri'=>$_SERVER['REQUEST_URI']])."\n",FILE_APPEND);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 37 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading37">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse37">37. sanitize_and_validate_email()</button>
        </h2>
        <div id="collapse37" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
function sanitize_and_validate_email($e){$c=filter_var(trim($e),FILTER_SANITIZE_EMAIL);return filter_var($c,FILTER_VALIDATE_EMAIL)?$c:false;}?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 38 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading38">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse38">38. Formulario seguro CSRF+Sanit</button>
        </h2>
        <div id="collapse38" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
session_start();if(empty($_SESSION['csrf']))$_SESSION['csrf']=bin2hex(random_bytes(16));?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 39 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading39">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse39">39. Redirección segura</button>
        </h2>
        <div id="collapse39" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$wl=['tudominio.com'];$t=$_GET['goto']??'/';$h=parse_url($t,PHP_URL_HOST);if(in_array($h,$wl))header('Location:'.$t);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 40 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading40">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse40">40. Upload seguro</button>
        </h2>
        <div id="collapse40" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$info=pathinfo($_FILES['f']['name']);$ext=strtolower($info['extension']);$base=preg_replace('/[^a-zA-Z0-9_-]/','_',$info['filename']);$dest='up/'.$base.'.'.$ext;if(move_uploaded_file($_FILES['f']['tmp_name'],$dest))echo'ok';?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 41 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading41">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse41">41. Prevención SQLi+XSS</button>
        </h2>
        <div id="collapse41" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$data=htmlspecialchars(trim($_POST['d']),ENT_QUOTES);
$pdo->prepare('INSERT INTO t(d) VALUES(:d)')->execute(['d'=>$data]);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 42 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading42">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse42">42. Hash contraseñas</button>
        </h2>
        <div id="collapse42" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$h=password_hash($_POST['pw'],PASSWORD_DEFAULT);?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 43 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading43">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse43">43. Verificar password</button>
        </h2>
        <div id="collapse43" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
if(!password_verify($_POST['pw'],$stored))die('No ok');?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 44 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading44">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse44">44. Auth JWT</button>
        </h2>
        <div id="collapse44" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
use Firebase\JWT\JWT;
$jwt=JWT::encode(['uid'=>1,'exp'=>time()+3600],'secret');?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 45 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading45">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse45">45. Decodificar JWT</button>
        </h2>
        <div id="collapse45" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
$decoded=JWT::decode($jwt,new Key('secret','HS256'));?></code><button class="copy-btn">Copiar</button></pre>
          </div>
        </div>
      </div>
      <!-- Ítem 46 -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading46">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse46">46. Middleware auth</button>
        </h2>
        <div id="collapse46" class="accordion-collapse collapse" data-bs-parent="#snippetsAccordion">
          <div class="accordion-body">
            <pre><code class="language-php"><?php
session_start();if(empty($_SESSION['uid']))header('Location:/login');?></code><button class="copy-btn">Copiar</button></pre>
          </div>
      <!-- ... Continue through 50 in this pattern -->
    </div>
  </main>
  <!-- Bootstrap JS & Highlight.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script>
    document.querySelectorAll('.copy-btn').forEach(btn => btn.addEventListener('click', () => {
      const code = btn.previousElementSibling.innerText;
      navigator.clipboard.writeText(code).then(() => btn.textContent = 'Copiado!');
      setTimeout(() => btn.textContent = 'Copiar', 2000);
    }));
  </script>
</body>
  <footer>
    <p style="text-align: center;color: #6335d7;">© 2025 [sualba.dev] Todos los derechos reservados</p>
    <p style="text-align: center;color:#6335d7">Este material forma parte de mi portfolio profesional y ha sido desarrollado como parte de mi formación en ciberseguridad.</p>
  </footer>
</html>
